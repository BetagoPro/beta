<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bnw.beta.domain.admin.dao.NoticeDAO">
    <!--게시글 등록-->
    <insert id="insert" parameterType="NoticeDTO" useGeneratedKeys="true" keyProperty="notice_no">
        <![CDATA[
        INSERT INTO notice(notice_title, notice_content, notice_category, notice_regdate, notice_isshow, member_id, view_cnt)
        VALUES (#{notice_title}, #{notice_content}, #{notice_category}, now(), "Y", #{member_id}, 0);
        ]]>
    </insert>

    <!-- 공지글 파일 등록 & 수정 -->
    <insert id="fileUpload" parameterType="NoticeFileDTO">
        <![CDATA[
        INSERT INTO filenotice (notice_no, file_name, file_rename, file_path, file_date)
        VALUES (#{notice_no}, #{file_name}, #{file_rename}, #{file_path}, now())
        ]]>
    </insert>

    <!--게시글 상세조회 -->
        <select id="detail" parameterType="Long" resultType="NoticeDTO">
        <![CDATA[
            SELECT n.notice_no, n.notice_title, n.notice_content, n.notice_category,
                   n.notice_regdate, n.notice_isshow, n.member_id, n.view_cnt
            FROM notice n
            WHERE n.notice_no = #{notice_no}
            ]]>
        </select>
    <!--파일 상세조회-->
    <select id="getNoticeFiles" parameterType="Long" resultType="NoticeFileDTO">
        <![CDATA[
        SELECT * FROM filenotice
        WHERE notice_no = #{notice_no}
        ]]>
    </select>

    <!--게시글 수정-->
    <update id="update" parameterType="NoticeDTO">
       <![CDATA[
        UPDATE notice
        SET notice_title = #{notice_title}, notice_content = #{notice_content}, notice_category = #{notice_category}
        WHERE notice_no = #{notice_no}
        ]]>
    </update>
    <!--사진 삭제-->
    <delete id="deleteFile" parameterType="NoticeFileDTO">
        <![CDATA[
        DELETE FROM filenotice
        WHERE notice_no = #{notice_no}
        ]]>
    </delete>

    <!--게시글 삭제-->
    <delete id="delete" parameterType="long">
        <![CDATA[
        UPDATE notice
        SET notice_isshow = 'N'
        WHERE notice_no = #{notice_no}
        ]]>
    </delete>

    <!--공지게시판 리스트조회-->
    <select id="noticeList" resultType="NoticeDTO">
        <![CDATA[
        SELECT notice_no, notice_title, notice_category, notice_regdate, member_id, view_cnt, notice_isshow
        FROM notice
        WHERE notice_isshow = 'Y'
        ORDER BY notice_no DESC
        ]]>
    </select>





</mapper>