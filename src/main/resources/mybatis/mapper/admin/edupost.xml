<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.bnw.beta.domain.admin.dao.EdupostDAO">
<!--     게시글 검색-->
    <sql id="search">
        <!-- 검색 키워드가 있을 때 -->
             <if test="keyword != null and keyword != ''">
                <choose>
                    <when test="searchType != null and searchType != '' || searchType2 != null and searchType2 != ''">
                        <choose>
                            <when test="'edupost_title'.equals(searchType)">
                                AND edupost_title LIKE CONCAT('%', #{keyword}, '%')
                            </when>
                            <when test="'edupost_content'.equals(searchType)">
                                AND edupost_content LIKE CONCAT('%', #{keyword}, '%')
                            </when>
                            <when test="'member_id'.equals(searchType)">
                                AND member_id LIKE CONCAT('%', #{keyword}, '%')
                            </when>
                            <when test="'edupost_category'.equals(searchType)">
                                AND edupost_category LIKE CONCAT('%', #{keyword}, '%')
                            </when>

                        </choose>
                    </when>
                        <when test="'edupost_category'.equals(searchType2)">
                            AND edupost_category LIKE CONCAT('%', #{keyword}, '%')
                        </when>
                    <otherwise>
                        AND
                        (
                        edupost_title LIKE CONCAT('%', #{keyword}, '%')
                        OR edupost_content LIKE CONCAT('%', #{keyword}, '%')
                        OR member_id LIKE CONCAT('%', #{keyword}, '%')
                        OR edupost_category LIKE CONCAT('%', #{keyword}, '%')
                        )
                    </otherwise>
                </choose>
            </if>
    </sql>
 <!--   <sql id="search">
        <choose>
            &lt;!&ndash; 선택+선택 &ndash;&gt;
            <when test="searchType != null and searchType != '' || searchType2 != null and searchType2 != ''">
                SELECT * FROM edupost;
            </when>

            &lt;!&ndash; 제목+선택+선택 &ndash;&gt;
            <when test="'edupost_title'.equals(searchType)">
                SELECT * FROM edupost WHERE edupost_title LIKE CONCAT('%', #{keyword}, '%');
            </when>

            &lt;!&ndash; 내용+선택+선택 &ndash;&gt;
            <when test="'edupost_content'.equals(searchType)">
                SELECT * FROM edupost WHERE edupost_content LIKE CONCAT('%', #{keyword}, '%');
            </when>

            &lt;!&ndash; 제목,내용+선택+선택 &ndash;&gt;
            <when test="'edupost_title'.equals(searchType) || 'edupost_category'.equals(searchType2)">
                SELECT * FROM edupost WHERE edupost_title LIKE CONCAT('%', #{keyword}, '%') OR edupost_category LIKE CONCAT('%', #{keyword}, '%');
            </when>

   &lt;!&ndash;         &lt;!&ndash; 선택+카테고리+선택 &ndash;&gt;
            <when test="(조건1 or 카테고리 != null) AND 조건2">
                SELECT * FROM 테이블명 WHERE 카테고리 = #{카테고리};
            </when>&ndash;&gt;

            &lt;!&ndash; 제목 + 카테고리 + 선택 &ndash;&gt;
            <otherwise>
                SELECT * FROM edupost WHERE
                (edupost_title LIKE CONCAT('%', #{keyword}, '%')
                OR edupost_content LIKE CONCAT('%', #{keyword}, '%')
                OR member_id LIKE CONCAT('%', #{keyword}, '%')
                OR edupost_category LIKE CONCAT('%', #{keyword}, '%'))
            </otherwise>
        </choose>
    </sql>-->

    <insert id="eduinsert" useGeneratedKeys="true" keyProperty="edupost_no" parameterType="EdupostDTO">
        <![CDATA[
            insert into edupost(edupost_title, edupost_category, edupost_type, edupost_date, edupost_fileadd, edupost_service, member_id, edupost_content)
            values (#{edupost_title},#{edupost_category},#{edupost_type}, NOW(), #{edupost_fileadd}, #{edupost_service}, #{member_id},#{edupost_content})
        ]]>
    </insert>
    <!--교육자료 목록보기-->
    <select id="edulist" parameterType="map" resultType="EdupostDTO">
        select edupost_no, edupost_category, edupost_type, edupost_title, edupost_date, member_id
        from edupost
        <where>
            <include refid="search"></include>
        </where>
        order by edupost_date DESC
        LIMIT #{page}, #{size};
    </select>

    <select id="count" resultType="int">
        select count(*)
        from edupost
        <where>
            <include refid="search"></include>
        </where>
    </select>

    <select id="findById" parameterType="long" resultType="EdupostDTO">
         <![CDATA[
        select edupost_no, edupost_title, edupost_category, edupost_type, edupost_fileadd, edupost_content, edupost_service, member_id
        from edupost
        where edupost_no = #{value}
        ]]>
    </select>

    <update id="update" parameterType="EdupostDTO">
        <![CDATA[
        update edupost
        set edupost_date = NOW(), edupost_title = #{edupost_title}, edupost_category = #{edupost_category}, edupost_type = #{edupost_type}, edupost_fileadd = #{edupost_fileadd},
            edupost_content = #{edupost_content}, edupost_service = #{edupost_service}
        where
            edupost_no = #{edupost_no}
        ]]>
    </update>
<!-- 게시글 삭제 -->
    <delete id="deleteById" parameterType="long">
        delete
        from edupost
        where
            edupost_no = #{edupost_no}
    </delete>
</mapper>