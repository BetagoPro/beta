<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>학습등록 상세페이지</title>
    <div th:replace="~{common/fragments/config :: configFragment}"></div>
    <link rel="stylesheet" type="text/css" th:href="@{/css/admin/notice/noticeWrite.css}">
</head>
<body>
<div th:replace="~{common/fragments/header :: headerFragment}"></div>
<div class="content">
    <div th:replace="~{common/sidebar/notice_sidebar :: notice_sidebarFragment}"></div>
    <div class="content-wrap">
<h2 class="border-bottom py-2" th:text="${post.edupost_title}"></h2>
    <div>
        <label for="edupost_title" class="">학습자료명</label>
        <input type="text" th:value="${post.edupost_title}" id="edupost_title" name="edupost_title" readonly/>
    </div>
    <div>
        <label for="edupost_category" >자료구분</label>
        <select id="edupost_category" th:value="${post.edupost_category}" name="edupost_category" readonly class="">
            <option value="튜토리얼">튜토리얼</option>
            <option value="교육영상">교육영상</option>
        </select>
    </div>
    <div>
        <label for="edupost_type">자료유형</label>
        <select id="edupost_type" name="edupost_type" th:value="${post.edupost_type}" readonly class="">
            <option value="묘수풀이">묘수풀이</option>
            <option value="사활">사활</option>
            <option value="영토">영토</option>
        </select>
    </div>
    <div>
        <label for="edupost_fileadd">자료file주소</label>
        <input type="text" th:value="${post.edupost_fileadd}" id="edupost_fileadd" name="edupost_fileadd" readonly/>
    </div>
    <div>
        <label for="edupost_service">서비스구분</label>
        <select id="edupost_service" th:value="${post.edupost_service}" name="edupost_service" readonly class="">
            <option value="유료">유료</option>
            <option value="무료">무료</option>
        </select>
    </div>
    <div>
        <label for="edupost_content">자료 내용</label>
        <textarea id="edupost_content" th:text="${post.edupost_content}" name="edupost_content" readonly></textarea>
    </div>
    <div>
        <table class="tb tb_row">
            <tbody>
                <tr>
                    <th scope="row">첨부파일</th>
                    <td id="files" colspan="3">
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
        <a th:href="@{|/edupost/update/${edupost_no}|}" class="btns del_btn">수정하기</a>
        <button type="button" onclick="deleteFile();" class="btns fn_add_btn"><span>삭제하기</span></button>
<script th:src="@{/js/admin/edupost/function.js}"></script>
<script type="text/javascript" th:src="@{/js/admin/edupost/common.js}"></script>
    </div>
    <div th:replace="~{common/fragments/footer :: footerFragment}"></div>
</body>
<script>
    window.onload = () => {
        findAllFile();

    }
    //전체 파일 조회
    function findAllFile() {

        // 1. API 호출
        const edupost_no = [[ ${edupost_no}]];
        const response = getJson(`/eduposts/${edupost_no}/files`);

        // 2. 로직 종료
        if ( !response.length ) {
            return false;
        }

        // 3. 파일 영역 추가
        let fileHtml = '<div class="file_down"><div class="cont">';
        response.forEach(row => {
            fileHtml += '<a href="/eduposts/' + edupost_no + '/files/' + row.filepost_no + '/download" download="' + row.edupost_name + '"><span class="icons"><i class="fas fa-folder-open"></i></span>' + row.edupost_name + '</a>';


        })
        fileHtml += '</div></div>';

        // 4. 파일 HTML 렌더링
        document.getElementById('files').innerHTML = fileHtml;
    }
    function deleteFile() {
        const id = [[${edupost_no}]];

        if (!confirm(id + '번 게시글을 삭제할까요?')) {
            return false;
        }
            // AJAX를 사용하여 서버로 게시물 삭제 요청을 보냅니다.
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/edupost/delete/' + id, true);
            xhr.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');
            xhr.onload = function () {
                if (xhr.status === 200) {
                    // 게시물 삭제에 성공한 경우에 대한 처리를 추가하세요.
                    window.location.href = '/edupost/list';
                }
            };
            xhr.send();
        }

</script>
</html>